---
- name: HashiCorp Vault deployment using ansible
  hosts: vault
  become: true
  gather_facts: true

  vars_files:
    - group_vars/common.yml
    - group_vars/{{ vault_env }}.yml

  pre_tasks:
    - name: Run preflight checks
      import_tasks: pre_checks.yml

  tasks:
    - name: Create users, directories, permissions
      import_tasks: directory_setup.yml

    - name: Install Vault binary
      import_tasks: vault_install.yml

    - name: Deploy TLS certificates
      import_tasks: tls.yml

    - name: Deploy Vault configuration
      import_tasks: config.yml

    - name: Configure and start Vault service
      import_tasks: service.yml
